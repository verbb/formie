{% set sizeMaxLimit = field.sizeLimit ?? 0 %}
{% set sizeMinLimit = field.sizeMinLimit ?? 0 %}
{% set limitFiles = field.limitFiles ?? 0 %}

{% set json = [] %}

{% if value %}
    {% for item in value.all() %}
        {% set json = json | merge([{ name: item.filename, url: item.url }]) %}
    {% endfor %}
{% endif %}

{% set attributes = {
    type: 'file',
    class: [
        'fui-input',
        field.settings.useDragDrop ? 'fui-hidden2' : null,
    ],
    id: options.id,
    name: field.handle ~ '[]',
    required: field.required ? true : false,
    multiple: limitFiles != 1,
    accept: field.accept,
    data: {
        'size-min-limit': sizeMinLimit,
        'size-max-limit': sizeMaxLimit,
        'file-limit': limitFiles,
        'fui-message': field.settings.errorMessage | t,
        'uploaded': json ? json | json_encode : null,
    },
    aria: {
        required: field.required ? 'true' : 'false',
    },
} | merge(field.getInputAttributes()) %}

<input {{ attr(attributes) }} />

{% if value %}
    {% set elements = value.all() %}

    {% if elements %}
        <div class="fui-file-summary">
            {% if elements | length == 1 %}
                <p>{{ '{num} file uploaded.' | t('formie', { num: elements | length }) }}</p>
            {% else %}
                <p>{{ '{num} files uploaded.' | t('formie', { num: elements | length }) }}</p>
            {% endif %}

            <ul>
                {% for element in elements %}
                    <li>{{ element.filename }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
{% endif %}