typeof Craft.Formie=="undefined"&&(Craft.Formie={});Craft.Formie.SubmissionIndex=Craft.BaseElementIndex.extend({editableForms:null,$newSubmissionBtnGroup:null,$newSubmissionBtn:null,init(t,e,i){this.on("selectSource",$.proxy(this,"updateButton")),this.on("selectSite",$.proxy(this,"updateButton")),this.base(t,e,i),this.settings.criteria={isIncomplete:!1,isSpam:!1};var a=this.$statusMenuBtn.menubtn().data("menubtn");if(a){var s=$('<li><a data-incomplete><span class="icon" data-icon="draft"></span> '+Craft.t("formie","Incomplete")+"</a></li>"),n=$('<li><a data-spam><span class="icon" data-icon="error"></span> '+Craft.t("formie","Spam")+"</a></li>"),r=$('<hr class="padded">');a.menu.addOptions(s.children()),a.menu.addOptions(n.children()),r.appendTo(a.menu.$container.find("ul:first")),s.appendTo(a.menu.$container.find("ul:first")),n.appendTo(a.menu.$container.find("ul:first")),a.menu.on("optionselect",$.proxy(this,"_handleStatusChange"))}},afterInit(){this.editableForms=[];var{editableSubmissions:t}=Craft.Formie;if(t)for(var e=0;e<t.length;e++){var i=t[e];this.getSourceByKey("form:"+i.id)&&this.editableForms.push(i)}this.base()},_handleStatusChange(t){this.statusMenu.$options.removeClass("sel");var e=$(t.selectedOption).addClass("sel");this.$statusMenuBtn.html(e.html()),this.trashed=!1,this.drafts=!1,this.status=null,this.settings.criteria.isIncomplete=!1,this.settings.criteria.isSpam=!1,Garnish.hasAttr(e,"data-spam")?this.settings.criteria.isSpam=!0:Garnish.hasAttr(e,"data-incomplete")?this.settings.criteria.isIncomplete=!0:Garnish.hasAttr(e,"data-trashed")?(this.trashed=!0,this.settings.criteria.isIncomplete=null,this.settings.criteria.isSpam=null):Garnish.hasAttr(e,"data-drafts")?this.drafts=!0:this.status=e.data("status"),this._updateStructureSortOption(),this.updateElements()},getViewClass(t){return t==="table"?Craft.Formie.SubmissionTableView:this.base(t)},getDefaultSort(){return["dateCreated","desc"]},getDefaultSourceKey(){if(this.settings.context==="index"&&typeof defaultFormieFormHandle!="undefined")for(var t=0;t<this.$sources.length;t++){var e=$(this.$sources[t]);if(e.data("handle")===defaultFormieFormHandle)return e.data("key")}return this.base()},updateButton(){if(!!this.$source){var t=this.$source.data("handle"),e,i,a;if(this.editableForms.length){this.$newSubmissionBtnGroup&&this.$newSubmissionBtnGroup.remove();var s;if(t){for(e=0;e<this.editableForms.length;e++)if(this.editableForms[e].handle===t){s=this.editableForms[e];break}}this.$newSubmissionBtnGroup=$('<div class="btngroup submit"/>');var n;if(s?(i=this._getFormTriggerHref(s),a=this.settings.context==="index"?Craft.t("formie","New submission"):Craft.t("formie","New {form} submission",{form:s.name}),this.$newSubmissionBtn=$('<a class="btn submit add icon" '+i+' role="button" tabindex="0">'+Craft.escapeHtml(a)+"</a>").appendTo(this.$newSubmissionBtnGroup),this.settings.context!=="index"&&this.addListener(this.$newSubmissionBtn,"click",function(h){this._openCreateSubmissionModal(h.currentTarget.getAttribute("data-id"))}),this.editableForms.length>1&&(n=$("<button/>",{type:"button",class:"btn submit menubtn"}).appendTo(this.$newSubmissionBtnGroup))):this.$newSubmissionBtn=n=$("<button/>",{type:"button",class:"btn submit add icon menubtn",text:Craft.t("formie","New submission")}).appendTo(this.$newSubmissionBtnGroup),n){var r='<div class="menu"><ul>';for(e=0;e<this.editableForms.length;e++){var o=this.editableForms[e];(this.settings.context==="index"&&$.inArray(this.siteId,o.sites)!==-1||this.settings.context!=="index"&&o!==s)&&(i=this._getFormTriggerHref(o),a=this.settings.context==="index"?o.name:Craft.t("formie","New {form} submission",{form:o.name}),r+="<li><a "+i+">"+Craft.escapeHtml(a)+"</a></li>")}r+="</ul></div>",$(r).appendTo(this.$newSubmissionBtnGroup);var l=new Garnish.MenuBtn(n);this.settings.context!=="index"&&l.on("optionSelect",h=>{this._openCreateSubmissionModal(h.option.getAttribute("data-id"))})}this.addButton(this.$newSubmissionBtnGroup)}if(this.settings.context==="index"&&typeof history!="undefined"){var d="formie/submissions";t&&(d+="/"+t),history.replaceState({},"",Craft.getUrl(d))}}},getSite(){if(!!this.siteId)return Craft.sites.find(t=>t.id==this.siteId)},_getFormTriggerHref(t){if(this.settings.context==="index"){const e=`formie/submissions/${t.handle}/new`,i=this.getSite(),a=i?{site:i.handle}:void 0;return`href="${Craft.getUrl(e,a)}"`}return`data-id="${t.id}"`},_openCreateSubmissionModal(t){if(!this.$newSubmissionBtn.hasClass("loading")){for(var e,i=0;i<this.editableForms.length;i++)if(this.editableForms[i].id==t){e=this.editableForms[i];break}if(!!e){this.$newSubmissionBtn.addClass("inactive");var a=this.$newSubmissionBtn.text();this.$newSubmissionBtn.text(Craft.t("formie","New {form} submission",{form:e.name})),Craft.createElementEditor(this.elementType,{hudTrigger:this.$newSubmissionBtnGroup,siteId:this.siteId,attributes:{formId:t},onHideHud:()=>{this.$newSubmissionBtn.removeClass("inactive").text(a)},onSaveElement:s=>{var n="form:"+e.id;this.sourceKey!==n&&this.selectSourceByKey(n),this.selectElementAfterUpdate(s.id),this.updateElements()}})}}}});Craft.Formie.SubmissionTableView=Craft.TableElementIndexView.extend({startDate:null,endDate:null,startDatepicker:null,endDatepicker:null,$chartExplorer:null,$totalValue:null,$chartContainer:null,$spinner:null,$error:null,$chart:null,$startDate:null,$endDate:null,afterInit(){this.$explorerContainer=$('<div class="chart-explorer-container"></div>').prependTo(this.$container),this.createChartExplorer(),this.base()},getStorage(t){return Craft.Formie.SubmissionTableView.getStorage(this.elementIndex._namespace,t)},setStorage(t,e){Craft.Formie.SubmissionTableView.setStorage(this.elementIndex._namespace,t,e)},createChartExplorer(){var t=$('<div class="chart-explorer"></div>').appendTo(this.$explorerContainer),e=$('<div class="chart-header"></div>').appendTo(t),i=$('<div class="date-range" />').appendTo(e),a=$('<div class="datewrapper"></div>').appendTo(i);$('<span class="to light">to</span>').appendTo(i);var s=$('<div class="datewrapper"></div>').appendTo(i),n=$('<div class="total"></div>').appendTo(e);$('<div class="total-label light">'+Craft.t("formie","Total Submissions")+"</div>").appendTo(n);var r=$('<div class="total-value-wrapper"></div>').appendTo(n),o=$('<span class="total-value">&nbsp;</span>').appendTo(r);this.$chartExplorer=t,this.$totalValue=o,this.$chartContainer=$('<div class="chart-container"></div>').appendTo(t),this.$spinner=$('<div class="spinner hidden" />').prependTo(e),this.$error=$('<div class="error"></div>').appendTo(this.$chartContainer),this.$chart=$('<div class="chart"></div>').appendTo(this.$chartContainer),this.$startDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(a),this.$endDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(s),this.$startDate.datepicker($.extend({onSelect:$.proxy(this,"handleStartDateChange")},Craft.datepickerOptions)),this.$endDate.datepicker($.extend({onSelect:$.proxy(this,"handleEndDateChange")},Craft.datepickerOptions)),this.startDatepicker=this.$startDate.data("datepicker"),this.endDatepicker=this.$endDate.data("datepicker"),this.addListener(this.$startDate,"keyup","handleStartDateChange"),this.addListener(this.$endDate,"keyup","handleEndDateChange");var l=this.getStorage("startTime")||new Date().getTime()-60*60*24*7*1e3,d=this.getStorage("endTime")||new Date().getTime();this.setStartDate(new Date(l)),this.setEndDate(new Date(d)),this.loadReport()},handleStartDateChange(){this.setStartDate(Craft.Formie.SubmissionTableView.getDateFromDatepickerInstance(this.startDatepicker))&&this.loadReport()},handleEndDateChange(){this.setEndDate(Craft.Formie.SubmissionTableView.getDateFromDatepickerInstance(this.endDatepicker))&&this.loadReport()},setStartDate(t){return this.startDate&&t.getTime()===this.startDate.getTime()?!1:(this.startDate=t,this.setStorage("startTime",this.startDate.getTime()),this.$startDate.val(Craft.formatDate(this.startDate)),this.endDate&&this.startDate.getTime()>this.endDate.getTime()&&this.setEndDate(new Date(this.startDate.getTime())),!0)},setEndDate(t){return this.endDate&&t.getTime()===this.endDate.getTime()?!1:(this.endDate=t,this.setStorage("endTime",this.endDate.getTime()),this.$endDate.val(Craft.formatDate(this.endDate)),this.startDate&&this.endDate.getTime()<this.startDate.getTime()&&this.setStartDate(new Date(this.endDate.getTime())),!0)},loadReport(){var t=this.settings.params;t.startDate=Craft.Formie.SubmissionTableView.getDateValue(this.startDate),t.endDate=Craft.Formie.SubmissionTableView.getDateValue(this.endDate),this.$spinner.removeClass("hidden"),this.$error.addClass("hidden"),this.$chart.removeClass("error"),Craft.postActionRequest("formie/charts/get-submissions-data",t,$.proxy(function(e,i){if(this.$spinner.addClass("hidden"),i==="success"&&typeof e.error=="undefined"){this.chart||(this.chart=new Craft.charts.Area(this.$chart));var a=new Craft.charts.DataTable(e.dataTable),s={formatLocaleDefinition:e.formatLocaleDefinition,orientation:e.orientation,formats:e.formats,dataScale:e.scale};this.chart.draw(a,s),this.$totalValue.html(e.totalHtml)}else{var n=Craft.t("formie","An unknown error occurred.");typeof e!="undefined"&&e&&typeof e.error!="undefined"&&(n=e.error),this.$error.html(n),this.$error.removeClass("hidden"),this.$chart.addClass("error")}},this))}},{storage:{},getStorage(t,e){return Craft.Formie.SubmissionTableView.storage[t]&&Craft.Formie.SubmissionTableView.storage[t][e]?Craft.Formie.SubmissionTableView.storage[t][e]:null},setStorage(t,e,i){typeof Craft.Formie.SubmissionTableView.storage[t]=="undefined"&&(Craft.Formie.SubmissionTableView.storage[t]={}),Craft.Formie.SubmissionTableView.storage[t][e]=i},getDateFromDatepickerInstance(t){return new Date(t.currentYear,t.currentMonth,t.currentDay)},getDateValue(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}});(function(t){t(document).on("click",".js-fui-submission-modal-send-btn",function(e){e.preventDefault(),new Craft.Formie.SendNotificationModal(t(this).data("id"))})})(jQuery);Craft.Formie.SendNotificationModal=Garnish.Modal.extend({init(t){this.$form=$('<form class="modal fui-send-notification-modal" method="post" accept-charset="UTF-8"/>').appendTo(Garnish.$bod),this.$body=$('<div class="body"><div class="spinner big"></div></div>').appendTo(this.$form);var e=$('<div class="footer"/>').appendTo(this.$form),i=$('<div class="buttons right"/>').appendTo(e);this.$cancelBtn=$('<input type="button" class="btn" value="'+Craft.t("formie","Cancel")+'"/>').appendTo(i),this.$updateBtn=$('<input type="button" class="btn submit" value="'+Craft.t("formie","Send Email Notification")+'"/>').appendTo(i),this.$footerSpinner=$('<div class="spinner right hidden"/>').appendTo(e),Craft.initUiElements(this.$form),this.addListener(this.$cancelBtn,"click","onFadeOut"),this.addListener(this.$updateBtn,"click","onSend"),this.base(this.$form),Craft.postActionRequest("formie/submissions/get-send-notification-modal-content",{id:t},$.proxy(function(a,s){s==="success"&&a.success&&(this.$body.html(a.modalHtml),Craft.appendHeadHtml(a.headHtml),Craft.appendBodyHtml(a.footHtml))},this))},onFadeOut(){this.$form.remove(),this.$shade.remove()},onSend(t){t.preventDefault(),this.$footerSpinner.removeClass("hidden");var e=this.$form.serialize();Craft.postActionRequest("formie/submissions/send-notification",e,$.proxy(function(i){this.$footerSpinner.addClass("hidden"),i.success?location.reload():Craft.cp.displayError(i.error)},this))}});Craft.registerElementIndexClass("verbb\\formie\\elements\\Submission",Craft.Formie.SubmissionIndex);typeof Craft.Formie=="undefined"&&(Craft.Formie={});(function(t){t(document).on("click",".js-fui-notification-modal-resend-btn",function(e){e.preventDefault(),new Craft.Formie.ResendNotificationModal(t(this).data("id"))})})(jQuery);Craft.Formie.ResendNotificationModal=Garnish.Modal.extend({init(t){this.$form=$('<form class="modal fui-resend-modal" method="post" accept-charset="UTF-8"/>').appendTo(Garnish.$bod),this.$body=$('<div class="body"><div class="spinner big"></div></div>').appendTo(this.$form);var e=$('<div class="footer"/>').appendTo(this.$form),i=$('<div class="buttons right"/>').appendTo(e);this.$cancelBtn=$('<input type="button" class="btn" value="'+Craft.t("formie","Cancel")+'"/>').appendTo(i),this.$updateBtn=$('<input type="button" class="btn submit" value="'+Craft.t("formie","Resend Email Notification")+'"/>').appendTo(i),this.$footerSpinner=$('<div class="spinner right hidden"/>').appendTo(e),Craft.initUiElements(this.$form),this.addListener(this.$cancelBtn,"click","onFadeOut"),this.addListener(this.$updateBtn,"click","onResend"),this.base(this.$form),Craft.postActionRequest("formie/sent-notifications/get-resend-modal-content",{id:t},$.proxy(function(a,s){s==="success"&&a.success&&(this.$body.html(a.modalHtml),Craft.appendHeadHtml(a.headHtml),Craft.appendBodyHtml(a.footHtml))},this))},onFadeOut(){this.$form.remove(),this.$shade.remove()},onResend(t){t.preventDefault(),this.$footerSpinner.removeClass("hidden");var e=this.$form.serialize();Craft.postActionRequest("formie/sent-notifications/resend",e,$.proxy(function(i){this.$footerSpinner.addClass("hidden"),i.success?location.reload():Craft.cp.displayError(i.error)},this))}});Craft.Formie.BulkResendElementAction=Garnish.Base.extend({init(t){new Craft.ElementActionTrigger({type:t,batch:!0,activate(e){new Craft.Formie.BulkResendModal(e.find(".element"),e)}})}});Craft.Formie.BulkResendModal=Garnish.Modal.extend({init(t,e){this.$element=t,this.$selectedItems=e;var i=e.length==1?"":"s",a="<strong>"+e.length+"</strong> notification"+i;this.$form=$('<form class="modal fitted" method="post" accept-charset="UTF-8"/>').appendTo(Garnish.$bod),this.$body=$('<div class="body" style="max-width: 560px;"><h2>'+Craft.t("formie","Bulk Resend Email Notification")+"</h2><p>"+Craft.t("formie","You are about to resend {desc}. You can resend each notification to their original recipients, or choose specific recipients.",{desc:a})+"</p></div>").appendTo(this.$form);var s=Craft.ui.createSelectField({label:Craft.t("formie","Recipients"),name:"recipientsType",options:[{label:Craft.t("formie","Original Recipients"),value:"original"},{label:Craft.t("formie","Custom Recipients"),value:"custom"}],toggle:!0,targetPrefix:"type-"}).appendTo(this.$body),n=$("<div/>",{id:"type-custom",class:"hidden"}).appendTo(this.$body);Craft.ui.createTextField({label:Craft.t("formie","Custom Recipients"),instructions:Craft.t("formie","Provide recipients for each email notification to be sent to. For multiple recipients, separate each with a comma."),name:"to",required:!0}).appendTo(n),this.$selectedItems.each((l,d)=>{$("<input/>",{type:"hidden",name:"ids[]",value:$(d).data("id")}).appendTo(this.$body)});var r=$('<div class="footer"/>').appendTo(this.$form),o=$('<div class="buttons right"/>').appendTo(r);this.$cancelBtn=$('<input type="button" class="btn" value="'+Craft.t("formie","Cancel")+'"/>').appendTo(o),this.$updateBtn=$('<input type="button" class="btn submit" value="'+Craft.t("formie","Resend Email Notifications")+'"/>').appendTo(o),this.$footerSpinner=$('<div class="spinner right hidden"/>').appendTo(r),this.addListener(this.$cancelBtn,"click","onFadeOut"),this.addListener(this.$updateBtn,"click","onResend"),this.addListener(s,"change","onSelectChange"),this.base(this.$form)},onSelectChange(){this.updateSizeAndPosition()},onFadeOut(){this.$form.remove(),this.$shade.remove()},onResend(t){t.preventDefault(),this.$footerSpinner.removeClass("hidden");var e=this.$form.serialize();Craft.postActionRequest("formie/sent-notifications/bulk-resend",e,$.proxy(function(i){this.$footerSpinner.addClass("hidden"),i.success?location.reload():Craft.cp.displayError(i.error)},this))}});typeof Craft.Formie=="undefined"&&(Craft.Formie={});(function(t){})(jQuery);
//# sourceMappingURL=formie-cp.js.map
