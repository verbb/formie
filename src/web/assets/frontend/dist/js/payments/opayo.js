!function(){var e={9371:function(e){"use strict";"undefined"!=typeof self?e.exports=self:"undefined"!=typeof window?e.exports=window:e.exports=Function("return this")()},9981:function(e,t,n){"use strict";var r=n(9371);e.exports=function(){return"object"==typeof n.g&&n.g&&n.g.Math===Math&&n.g.Array===Array?n.g:r}},1042:function(e,t,n){(function(){var t,r,i,a,o,s,l,d,c,u,h,f,m,g,p,v,y,b,C,E,$,w,S,D,L,A,x=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};p=n(9981)(),r=n(8),o=[{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[4],luhn:!0},{type:"dankort",pattern:/^5019/,format:l=/(\d{1,4})/g,length:[16],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"elo",pattern:/^401178|^401179|^431274|^438935|^451416|^457393|^457631|^457632|^504175|^627780|^636297|^636369|^636368|^(506699|5067[0-6]\d|50677[0-8])|^(50900\d|5090[1-9]\d|509[1-9]\d{2})|^65003[1-3]|^(65003[5-9]|65004\d|65005[0-1])|^(65040[5-9]|6504[1-3]\d)|^(65048[5-9]|65049\d|6505[0-2]\d|65053[0-8])|^(65054[1-9]|6505[5-8]\d|65059[0-8])|^(65070\d|65071[0-8])|^65072[0-7]|^(65090[1-9]|65091\d|650920)|^(65165[2-9]|6516[6-7]\d)|^(65500\d|65501\d)|^(65502[1-9]|6550[3-4]\d|65505[0-8])|^(65092[1-9]|65097[0-8])/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"hipercard",pattern:/^(384100|384140|384160|606282|637095|637568|60(?!11))/,format:l,length:[14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^(308[8-9]|309[0-3]|3094[0]{4}|309[6-9]|310[0-2]|311[2-9]|3120|315[8-9]|333[7-9]|334[0-9]|35)/,format:l,length:[16,19],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:l,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"maestro",pattern:/^(50|5[6-9]|6007|6220|6304|6703|6708|6759|676[1-3])/,format:l,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^(5[1-5]|677189)|^(222[1-9]|2[3-6]\d{2}|27[0-1]\d|2720)/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"mir",pattern:/^220[0-4][0-9][0-9]\d{10}$/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"troy",pattern:/^9792/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:l,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"visaelectron",pattern:/^4(026|17500|405|508|844|91[37])/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"visa",pattern:/^4/,format:l,length:[13,16],cvcLength:[3],luhn:!0}],i=function(e){var t,n,r,i,a;for(e=(e+"").replace(/\D/g,""),n=void 0,r=0,i=o.length;r<i;r++)t=o[r],(a=e.match(t.pattern))&&(!n||a[0].length>n[1][0].length)&&(n=[t,a]);return n&&n[0]},a=function(e){var t,n,r;for(n=0,r=o.length;n<r;n++)if((t=o[n]).type===e)return t},y=function(e){var t,n,r,i,a,o;for(a=!0,o=0,r=0,i=(n=(e+"").split("").reverse()).length;r<i;r++)t=n[r],t=parseInt(t,10),(a=!a)&&(t*=2),t>9&&(t-=9),o+=t;return o%10==0},v=function(e){var t;try{if(null!=e.selectionStart&&e.selectionStart!==e.selectionEnd)return!0;if(null!=("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)&&document.selection.createRange().text)return!0}catch(e){e}return!1},b=function(e){return setTimeout((function(){var n,i;return n=e.target,i=r.val(n),i=t.fns.formatCardNumber(i),s(n,i),r.trigger(n,"change")}))},u=function(e){return function(t){var n,a,o,s,l,d,c,u,h,f,m;if(t.which>0?(a=String.fromCharCode(t.which),m=r.val(t.target)+a):(a=t.data,m=r.val(t.target)),/^\d+$/.test(a)){for(u=t.target,n=i(m),d=m.replace(/\D/g,"").length,f=[16],n&&(f=n.length),e&&(f=f.filter((function(t){return t<=e}))),o=s=0,l=f.length;s<l;o=++s)if(!(d>=(h=f[o])&&f[o+1])&&d>=h)return;if(!v(u))return c=n&&"amex"===n.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,m=m.substring(0,m.length-1),c.test(m)?(t.preventDefault(),r.val(u,m+" "+a),r.trigger(u,"change")):void 0}}},d=function(e){var t,n;if(t=e.target,n=r.val(t),!e.meta&&8===e.which&&!v(t))return/\d\s$/.test(n)?(e.preventDefault(),r.val(t,n.replace(/\d\s$/,"")),r.trigger(t,"change")):/\s\d?$/.test(n)?(e.preventDefault(),r.val(t,n.replace(/\s\d?$/,"")),r.trigger(t,"change")):void 0},h=function(e){var t,n,i;if(n=e.target,e.which>0?(t=String.fromCharCode(e.which),i=r.val(n)+t):(t=e.data,i=r.val(n)),/^\d+$/.test(t))return/^\d$/.test(i)&&"0"!==i&&"1"!==i?(e.preventDefault(),r.val(n,"0"+i+" / "),r.trigger(n,"change")):/^\d\d$/.test(i)?(e.preventDefault(),r.val(n,i+" / "),r.trigger(n,"change")):void 0},g=function(e){var t,n,i;if(t=String.fromCharCode(e.which),/^\d+$/.test(t))return n=e.target,i=r.val(n)+t,/^\d$/.test(i)&&"0"!==i&&"1"!==i?(e.preventDefault(),r.val(n,"0"+i),r.trigger(n,"change")):/^\d\d$/.test(i)?(e.preventDefault(),r.val(n,""+i),r.trigger(n,"change")):void 0},f=function(e){var t,n,i;if(t=String.fromCharCode(e.which),/^\d+$/.test(t))return n=e.target,i=r.val(n),/^\d\d$/.test(i)?(r.val(n,i+" / "),r.trigger(n,"change")):void 0},m=function(e){var t,n;if("/"===String.fromCharCode(e.which))return t=e.target,n=r.val(t),/^\d$/.test(n)&&"0"!==n?(r.val(t,"0"+n+" / "),r.trigger(t,"change")):void 0},c=function(e){var t,n;if(!e.metaKey&&(t=e.target,n=r.val(t),8===e.which&&!v(t)))return/\d(\s|\/)+$/.test(n)?(e.preventDefault(),r.val(t,n.replace(/\d(\s|\/)*$/,"")),r.trigger(t,"change")):/\s\/\s?\d?$/.test(n)?(e.preventDefault(),r.val(t,n.replace(/\s\/\s?\d?$/,"")),r.trigger(t,"change")):void 0},D=function(e){var t;return!(!e.metaKey&&!e.ctrlKey)||(32===e.which?e.preventDefault():0===e.which||(e.which<33||(t=String.fromCharCode(e.which),/[\d\s]/.test(t)?void 0:e.preventDefault())))},E=function(e){return function(t){var n,a,o,s,l;if(s=t.target,a=String.fromCharCode(t.which),/^\d+$/.test(a)&&!v(s))return l=(r.val(s)+a).replace(/\D/g,""),o=16,(n=i(l))&&(o=n.length[n.length.length-1]),e&&(o=Math.min(o,e)),l.length<=o?void 0:t.preventDefault()}},w=function(e,t){var n,i;if(i=e.target,n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!v(i))return(r.val(i)+n).replace(/\D/g,"").length>t?e.preventDefault():void 0},$=function(e){return w(e,6)},S=function(e){return w(e,2)},L=function(e){return w(e,4)},C=function(e){var t,n;if(n=e.target,t=String.fromCharCode(e.which),/^\d+$/.test(t)&&!v(n))return(r.val(n)+t).length<=4?void 0:e.preventDefault()},A=function(e){var n,i,a,s,l;if(s=e.target,l=r.val(s),a=t.fns.cardType(l)||"unknown",!r.hasClass(s,a))return n=function(){var e,t,n;for(n=[],e=0,t=o.length;e<t;e++)i=o[e],n.push(i.type);return n}(),r.removeClass(s,"unknown"),r.removeClass(s,n.join(" ")),r.addClass(s,a),r.toggleClass(s,"identified","unknown"!==a),r.trigger(s,"payment.cardType",a)},s=function(e,t){var n;if(n=e.selectionEnd,r.val(e,t),n)return e.selectionEnd=n},t=function(){function e(){}return e.J=r,e.fns={cardExpiryVal:function(e){var t,n,r;return t=(n=(e=e.replace(/\s/g,"")).split("/",2))[0],2===(null!=(r=n[1])?r.length:void 0)&&/^\d+$/.test(r)&&(r=(new Date).getFullYear().toString().slice(0,2)+r),{month:t=parseInt(t,10),year:r=parseInt(r,10)}},validateCardNumber:function(e){var t,n;return e=(e+"").replace(/\s+|-/g,""),!!/^\d+$/.test(e)&&(!!(t=i(e))&&(n=e.length,x.call(t.length,n)>=0&&(!1===t.luhn||y(e))))},validateCardExpiry:function(t,n){var i,a,o,s;return"object"==typeof t&&"month"in t?(t=(o=t).month,n=o.year):"string"==typeof t&&x.call(t,"/")>=0&&(t=(s=e.fns.cardExpiryVal(t)).month,n=s.year),!(!t||!n)&&(t=r.trim(t),n=r.trim(n),!!/^\d+$/.test(t)&&(!!/^\d+$/.test(n)&&(!!((t=parseInt(t,10))&&t<=12)&&(2===n.length&&(n=(new Date).getFullYear().toString().slice(0,2)+n),a=new Date(n,t),i=new Date,a.setMonth(a.getMonth()-1),a.setMonth(a.getMonth()+1,1),a>i))))},validateCardCVC:function(e,t){var n,i;return e=r.trim(e),!!/^\d+$/.test(e)&&(t&&a(t)?(n=e.length,x.call(null!=(i=a(t))?i.cvcLength:void 0,n)>=0):e.length>=3&&e.length<=4)},cardType:function(e){var t;return e&&(null!=(t=i(e))?t.type:void 0)||null},formatCardNumber:function(e){var t,n,r,a;return(t=i(e))?(a=t.length[t.length.length-1],e=(e=e.replace(/\D/g,"")).slice(0,a),t.format.global?null!=(r=e.match(t.format))?r.join(" "):void 0:null!=(n=t.format.exec(e))?(n.shift(),(n=n.filter((function(e){return e}))).join(" ")):void 0):e}},e.restrictNumeric=function(e){return r.on(e,"keypress",D),r.on(e,"input",D)},e.cardExpiryVal=function(t){return e.fns.cardExpiryVal(r.val(t))},e.formatCardCVC=function(t){return e.restrictNumeric(t),r.on(t,"keypress",C),r.on(t,"input",C),t},e.formatCardExpiry=function(t){var n,i;return e.restrictNumeric(t),t.length&&2===t.length?(n=t[0],i=t[1],this.formatCardExpiryMultiple(n,i)):(r.on(t,"keypress",$),r.on(t,"keypress",h),r.on(t,"keypress",m),r.on(t,"keypress",f),r.on(t,"keydown",c),r.on(t,"input",h)),t},e.formatCardExpiryMultiple=function(e,t){return r.on(e,"keypress",S),r.on(e,"keypress",g),r.on(e,"input",g),r.on(t,"keypress",L),r.on(t,"input",L)},e.formatCardNumber=function(t,n){return e.restrictNumeric(t),r.on(t,"keypress",E(n)),r.on(t,"keypress",u(n)),r.on(t,"keydown",d),r.on(t,"keyup blur",A),r.on(t,"blur",u(n)),r.on(t,"paste",b),r.on(t,"input",u(n)),t},e.getCardArray=function(){return o},e.setCardArray=function(e){return o=e,!0},e.addToCardArray=function(e){return o.push(e)},e.removeFromCardArray=function(e){var t;for(t in o)o[t].type===e&&o.splice(t,1);return!0},e}(),e.exports=t,p.Payment=t}).call(this)},8:function(e){(function(){var t,n,r;(t=function(e){return t.isDOMElement(e)?e:document.querySelectorAll(e)}).isDOMElement=function(e){return e&&null!=e.nodeName},r=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,t.trim=function(e){return null===e?"":(e+"").replace(r,"")},n=/\r/g,t.val=function(e,t){var r;return arguments.length>1?e.value=t:"string"==typeof(r=e.value)?r.replace(n,""):null===r?"":r},t.preventDefault=function(e){if("function"!=typeof e.preventDefault)return e.returnValue=!1,!1;e.preventDefault()},t.normalizeEvent=function(e){var n;return null==(e={which:null!=(n=e).which?n.which:void 0,target:n.target||n.srcElement,preventDefault:function(){return t.preventDefault(n)},originalEvent:n,data:n.data||n.detail}).which&&(e.which=null!=n.charCode?n.charCode:n.keyCode),e},t.on=function(e,n,r){var i,a,o,s,l,d,c,u;if(e.length)for(a=0,s=e.length;a<s;a++)i=e[a],t.on(i,n,r);else{if(!n.match(" "))return c=r,r=function(e){return e=t.normalizeEvent(e),c(e)},e.addEventListener?e.addEventListener(n,r,!1):e.attachEvent?(n="on"+n,e.attachEvent(n,r)):void(e["on"+n]=r);for(o=0,l=(u=n.split(" ")).length;o<l;o++)d=u[o],t.on(e,d,r)}},t.addClass=function(e,n){var r;return e.length?function(){var i,a,o;for(o=[],i=0,a=e.length;i<a;i++)r=e[i],o.push(t.addClass(r,n));return o}():e.classList?e.classList.add(n):e.className+=" "+n},t.hasClass=function(e,n){var r,i,a,o;if(e.length){for(i=!0,a=0,o=e.length;a<o;a++)r=e[a],i=i&&t.hasClass(r,n);return i}return e.classList?e.classList.contains(n):new RegExp("(^| )"+n+"( |$)","gi").test(e.className)},t.removeClass=function(e,n){var r,i,a,o,s,l;if(e.length)return function(){var r,a,o;for(o=[],r=0,a=e.length;r<a;r++)i=e[r],o.push(t.removeClass(i,n));return o}();if(e.classList){for(l=[],a=0,o=(s=n.split(" ")).length;a<o;a++)r=s[a],l.push(e.classList.remove(r));return l}return e.className=e.className.replace(new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi")," ")},t.toggleClass=function(e,n,r){var i;return e.length?function(){var a,o,s;for(s=[],a=0,o=e.length;a<o;a++)i=e[a],s.push(t.toggleClass(i,n,r));return s}():r?t.hasClass(e,n)?void 0:t.addClass(e,n):t.removeClass(e,n)},t.append=function(e,n){var r;return e.length?function(){var i,a,o;for(o=[],i=0,a=e.length;i<a;i++)r=e[i],o.push(t.append(r,n));return o}():e.insertAdjacentHTML("beforeend",n)},t.find=function(e,t){return(e instanceof NodeList||e instanceof Array)&&(e=e[0]),e.querySelectorAll(t)},t.trigger=function(e,t,n){var r,i;try{i=new CustomEvent(t,{detail:n})}catch(r){r,(i=document.createEvent("CustomEvent")).initCustomEvent?i.initCustomEvent(t,!0,!0,n):i.initEvent(t,!0,!0,n)}return e.dispatchEvent(i)},e.exports=t}).call(this)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t||(t=Math.random().toString(36).substr(2,5)),`${e}.${t}`},t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return window.FormieTranslations&&(e=window.FormieTranslations[e]||e),e.replace(/{([a-zA-Z0-9]+)}/g,((e,n)=>t[n]?t[n]:e))};class r{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.initialized=!1,this.$form=e.$form,this.form=this.$form.form,this.$field=e.$field,this.successClass=this.form.getClasses("success"),this.successMessageClass=this.form.getClasses("successMessage"),this.errorClass=this.form.getClasses("error"),this.errorMessageClass=this.form.getClasses("errorMessage"),this.isVisible=!1;const t=new IntersectionObserver((e=>{0==e[0].intersectionRatio?(this.isVisible=!1,this.initialized&&this.onHide()):(this.isVisible=!0,this.initialized&&this.onShow())}),{root:this.$form});setTimeout((()=>{t.observe(this.$field)}),500)}removeSuccess(){this.$field.classList.remove(this.successClass);const e=this.$field.querySelector(`.${this.successMessageClass}`);e&&e.remove()}addSuccess(e){this.$field.classList.add(this.successClass);const t=this.$field.querySelector("[data-field-type] > div");if(!t)return console.error("Unable to find `[data-field-type] > div` to add success message.");const n=document.createElement("div");n.className=this.successMessageClass,n.textContent=e,t.appendChild(n)}removeError(){this.$field.classList.remove(this.errorClass);const e=this.$field.querySelector(`.${this.errorMessageClass}`);e&&e.remove()}addError(e){this.$field.classList.add(this.errorClass);const t=this.$field.querySelector("[data-field-type] > div");if(!t)return console.error("Unable to find `[data-field-type] > div` to add error message.");const n=document.createElement("div");n.className=this.errorMessageClass,n.textContent=e,t.appendChild(n),this.submitHandler&&this.submitHandler.formSubmitError()}updateInputs(e,t){const n=this.$field.querySelector(`[name*="${e}"]`);n&&(n.value=t)}getBillingData(){if(!this.billingDetails)return{};const e={};if(this.billingDetails.billingName){const t=this.getFieldValue(this.billingDetails.billingName);t&&(e.name=t)}if(this.billingDetails.billingEmail){const t=this.getFieldValue(this.billingDetails.billingEmail);t&&(e.email=t)}if(this.billingDetails.billingAddress){e.address={};const t=this.getFieldValue(`${this.billingDetails.billingAddress}[address1]`),n=this.getFieldValue(`${this.billingDetails.billingAddress}[address2]`),r=this.getFieldValue(`${this.billingDetails.billingAddress}[address3]`),i=this.getFieldValue(`${this.billingDetails.billingAddress}[city]`),a=this.getFieldValue(`${this.billingDetails.billingAddress}[zip]`),o=this.getFieldValue(`${this.billingDetails.billingAddress}[state]`),s=this.getFieldValue(`${this.billingDetails.billingAddress}[country]`);t&&(e.address.line1=t),n&&(e.address.line2=n),r&&(e.address.line3=r),i&&(e.address.city=i),a&&(e.address.postal_code=a),o&&(e.address.state=o),s&&(e.address.country=s)}new CustomEvent("modifyBillingDetails",{bubbles:!0,detail:{provider:this,billing:e}});return{billing_details:e}}getFieldValue(e){let t="";e=this.getFieldName(e);const n=this.getFormField(e);return n&&n.forEach((e=>"checkbox"!==e.type&&"radio"!==e.type||e.checked?t=e.value:void 0)),t}getFormField(e){let t=this.$form.querySelectorAll(`[name="${e}"]`);const n=this.$form.querySelectorAll(`[name="${e}[]"]`);return n.length&&(t=n),t}getFieldName(e){return`fields[${e=e.replace("{","").replace("}","").replace("]","").split("[").join("][")}]`}onShow(){}onHide(){}}window.FormiePaymentProvider=r;const i=["input","select","textarea","button","summary","a[href]","area[href]","embed","iframe","object","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'];function a(e,t=!1){"function"==typeof e.focus&&e.focus({preventScroll:!t})}function o(e,t=!1){const n=s(e);if(!n.length)return!1;a(n[0],t)}function s(e){return Array.from(e.querySelectorAll(i.join(","))).filter((e=>function(e){let t=parseInt(e.getAttribute("tabindex")||"",10);return!(e.hidden||t&&t<0||e.matches(":disabled")||!e.matches(i.join(","))||l(e)&&!function(e){if(!l(e))return!1;let t=e.form||document;return!Array.from(t.getElementsByName(e.name)).some((e=>e.checked))||e.checked}(e)||!function(e){return 0!==e.getClientRects().length&&"visible"===window.getComputedStyle(e).visibility}(e))}(e)))}function l(e){return e instanceof HTMLInputElement&&"radio"===e.type}let d,c;function u(e){let{currentTarget:t}=e;if(!(t instanceof HTMLElement&&t.dataset.dialogOpen))return;let n=g(t.dataset.dialogOpen);n&&(n.open(),e.preventDefault())}function h(e){let{currentTarget:t}=e;if(!(t instanceof HTMLElement&&t.dataset.dialogClose))return;let n=g(t.dataset.dialogClose);n&&(n.close(),e.preventDefault())}Object.freeze({__proto__:null,get openers(){return d},get closers(){return c},mount:function(){d=Array.from(document.querySelectorAll("[data-dialog-open]")),c=Array.from(document.querySelectorAll("[data-dialog-close]")),d.forEach((e=>e.addEventListener("click",u))),c.forEach((e=>e.addEventListener("click",h)))},unmount:function(){d=[],c=[],d.forEach((e=>e.removeEventListener("click",u))),c.forEach((e=>e.removeEventListener("click",h)))}});const f={alert:!1,description:void 0,label:"Dialog",manageFocus:!0,openClass:"is-open"},m={};function g(e){return void 0===e?null:Object.prototype.hasOwnProperty.call(m,e)?m[e]:null}var p=n(1042),v=n.n(p);window.FormieOpayo=class extends r{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.$form=e.$form,this.form=this.$form.form,this.$field=e.$field,this.useSandbox=e.useSandbox,this.integrationHandle=e.handle,this.currency=e.currency,this.amountType=e.amountType,this.amountFixed=e.amountFixed,this.amountVariable=e.amountVariable,this.opayoScriptId="FORMIE_OPAYO_SCRIPT",this.initialized=!0}onShow(){this.initField()}onHide(){this.onAfterSubmit(),this.form.removeEventListener(e("onFormiePaymentValidate","opayo")),this.form.removeEventListener(e("onAfterFormieSubmit","opayo")),this.form.removeEventListener(e("FormiePaymentOpayo3DS","opayo"))}initField(){if(!document.getElementById(this.opayoScriptId)){const e=document.createElement("script");e.id=this.opayoScriptId,this.useSandbox?e.src="https://pi-test.sagepay.com/api/v1/js/sagepay.js":e.src="https://pi-live.sagepay.com/api/v1/js/sagepay.js",e.async=!0,e.defer=!0,document.body.appendChild(e)}this.form.addEventListener(this.$form,e("onFormiePaymentValidate","opayo"),this.onValidate.bind(this)),this.form.addEventListener(this.$form,e("onAfterFormieSubmit","opayo"),this.onAfterSubmit.bind(this)),this.form.addEventListener(this.$form,e("FormiePaymentOpayo3DS","opayo"),this.onValidate3DS.bind(this)),window.addEventListener("message",this.onMessage.bind(this),!1),v().formatCardNumber(this.$field.querySelector('[data-opayo-card="card-number"]')),v().formatCardExpiry(this.$field.querySelector('[data-opayo-card="expiry-date"]')),v().formatCardCVC(this.$field.querySelector('[data-opayo-card="security-code"]'))}onValidate(e){if("submit"===this.form.submitAction&&!e.detail.invalid){e.preventDefault(),this.submitHandler=e.detail.submitHandler,this.removeError();try{const e=this.$form.getAttribute("action"),n=new XMLHttpRequest;n.open("POST",e||window.location.href,!0),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Cache-Control","no-cache"),n.ontimeout=()=>{self.addError(t("The request timed out."))},n.onerror=e=>{self.addError(t("The request encountered a network error. Please try again."))},n.onload=()=>{if(n.status>=200&&n.status<300)try{const e=JSON.parse(n.responseText),t={cardholderName:this.$field.querySelector('[data-opayo-card="cardholder-name"]').value,cardNumber:this.$field.querySelector('[data-opayo-card="card-number"]').value,expiryDate:this.$field.querySelector('[data-opayo-card="expiry-date"]').value,securityCode:this.$field.querySelector('[data-opayo-card="security-code"]').value};t.cardNumber=t.cardNumber.replace(/[\s/]/g,""),t.expiryDate=t.expiryDate.replace(/[\s/]/g,""),sagepayOwnForm({merchantSessionKey:e.merchantSessionKey}).tokeniseCardDetails({cardDetails:t,onTokenised:t=>{t.success?(this.updateInputs("opayoTokenId",t.cardIdentifier),this.updateInputs("opayoSessionKey",e.merchantSessionKey),this.submitHandler.submitForm()):(console.error(t),this.addError(t.errors[0].message))}})}catch(e){this.addError(t("Unable to parse response `{e}`.",{e:e}))}else this.addError(`${n.status}: ${n.statusText}`)};const r=new FormData;r.append("action","formie/payment-webhooks/process-callback"),r.append("merchantSessionKey",!0),r.append("handle",this.integrationHandle),n.send(r)}catch(e){console.error(e),this.addError(e)}}}addLoading(){this.form.formTheme&&this.form.formTheme.addLoading()}removeLoading(){this.form.formTheme&&this.form.formTheme.removeLoading()}onMessage(e){if("FormiePaymentOpayo3DSResponse"===e.data.message){if(this.dialog&&this.dialog.close(),this.removeError(),e.data.value.error)return this.removeLoading(),this.addError(e.data.value.error.message);this.updateInputs("opayo3DSComplete",e.data.value.transactionId),this.submitHandler.submitForm()}}onValidate3DS(e){try{const{data:t}=e.detail;this.addLoading();const n=`fui-opayo-dialog-${(Math.random()+1).toString(36).substring(7)}`,r=document.createElement("div");r.setAttribute("class","fui-modal"),r.setAttribute("id",n);const i=document.createElement("div");i.setAttribute("class","fui-modal-backdrop"),i.setAttribute("data-dialog-close","dialog"),r.appendChild(i);const l=document.createElement("div");l.setAttribute("class","fui-modal-content"),r.appendChild(l);const d=document.createElement("div");d.setAttribute("class","fui-loading fui-loading-large"),d.setAttribute("style","--fui-loading-width: 3rem; --fui-loading-height: 3rem; --fui-loading-border-width: 4px; top: 50%; margin-top: -1.5rem;"),l.appendChild(d);const c=document.createElement("iframe");c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.setAttribute("style","width: 100%; height: 100%; position: relative; z-index: 1;");const u=`<form action="${t.acsUrl}" method="post">\n                <input type="hidden" name="creq" value="${t.creq}" />\n                <input type="hidden" name="threeDSSessionData" value="${t.threeDSSessionData}" />\n                <input type="hidden" name="MD" value="${this.merchantSessionKey}" />\n                <input type="hidden" name="TermUrl" value="${t.redirectUrl}" />\n                <input type="hidden" name="ThreeDSNotificationURL" value="${t.redirectUrl}" />\n            </form>\n            <script>document.forms[0].submit();<\/script>`;l.appendChild(c),document.body.appendChild(r),c.contentWindow.document.open(),c.contentWindow.document.write(u),c.contentWindow.document.close(),this.dialog=function(e,t={}){let n,r=!1,i=!1,l=document.getElementById(e);if(!l)return;if(m.hasOwnProperty(e))return m[e];const d=Object.assign({},f,t);function c(e){"Escape"===e.key&&h()}function u(e,t=!0){!r&&i&&g("open")&&(r=!0,l.classList.add(d.openClass),document.addEventListener("keydown",c,!0),n&&(void 0===e&&null!==l.querySelector("[data-dialog-autofocus]")&&(e=l.querySelector("[data-dialog-autofocus]")),n.activate(e,t)))}function h(e,t=!0){r&&i&&g("close")&&(n&&n.deactivate(e,t),r=!1,document.removeEventListener("keydown",c,!0),l.classList.remove(d.openClass))}function g(t){let n=new CustomEvent("dialog:"+t,{bubbles:!0,cancelable:!0,detail:{id:e}});return l.dispatchEvent(n)}d.manageFocus&&(n=function(e){let t=!1,n=null,r=null;function i(t){let r=t.target;if(e.contains(r))return t.stopPropagation(),void(n=r);t.preventDefault(),n?a(n,!0):o(e,!0)}function l(t){"Tab"!==t.key||t.altKey||t.ctrlKey||t.metaKey||function(e,t){let n=document.activeElement,r=s(e),i=r[0],o=r[r.length-1];t.shiftKey&&n==i?(a(o,!0),t.preventDefault()):t.shiftKey||n!=o||(a(i,!0),t.preventDefault())}(e,t)}return{activated:t,activate:function(n,s=!1){t||(r=document.activeElement,n?a(n,s):null!==n&&o(e,s),document.addEventListener("focusin",i,!1),document.addEventListener("keydown",l,!1),t=!0)},deactivate:function(e,o=!1){if(!t)return;document.removeEventListener("focusin",i,!1),document.removeEventListener("keydown",l,!1);let s=e||(null!==e?r:null);s&&a(s,o),t=!1,n=null}}}(l));const p={close:h,create:function(){if(i)return!1;let e=d.alert?"alertdialog":"dialog";if(l.setAttribute("tabindex","-1"),l.setAttribute("role",e),l.setAttribute("aria-modal","true"),d.label){let e=document.getElementById(d.label)?"aria-labelledby":"aria-label";l.setAttribute(e,d.label)}d.description&&document.getElementById(d.description)&&l.setAttribute("aria-describedby",d.description),i=!0,g("create")},destroy:function(){if(!i)return!1;h(),i=!1,["role","tabindex","aria-modal","aria-label","aria-labelledby","aria-describedby"].forEach((e=>l.removeAttribute(e))),g("destroy")},element:l,id:e,initiated:i,get isOpen(){return r},off:function(e,t){let n="dialog:"+e;l.removeEventListener(n,t)},on:function(e,t){let n="dialog:"+e;l.addEventListener(n,t)},open:u,toggle:function(e=!r){e?u():h()}};return m[e]=p}(n),this.dialog&&(this.dialog.create(),this.dialog.open())}catch(e){console.error(e),self.addError(e)}}onAfterSubmit(e){this.updateInputs("opayoTokenId",""),this.updateInputs("opayoSessionKey",""),this.updateInputs("opayo3DSComplete","")}}}()}();